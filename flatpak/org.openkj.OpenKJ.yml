app-id: org.openkj.OpenKJ
runtime: org.kde.Platform
runtime-version: 5.15
sdk: org.kde.Sdk
command: openkj
modules:
  - codecs/liba52.json
  - codecs/libmpeg2.json
  - codecs/gst-plugins-ugly.json
  - codecs/libass.json
  - codecs/ffmpeg.json
  - codecs/gst-libav.json
  - codecs/gst-plugins-bad.json
  - name: rubberband 
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/breakfastquay/rubberband.git
        branch: default
  - name: fmt 
    buildsystem: cmake-ninja
    builddir: yes
    config-opts:
      - "-DFMT_TEST=OFF"
    sources:
      - type: git
        url: https://github.com/fmtlib/fmt.git
        branch: master 
  - name: spdlog 
    buildsystem: cmake-ninja
    builddir: yes
    config-opts:
      - "-DSPDLOG_BUILD_EXAMPLE=OFF"
      - "-DSPDLOG_BUILD_TESTS=OFF"
    sources:
      - type: git
        url: https://github.com/gabime/spdlog.git
        branch: v1.x
  - name: taglib 
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/taglib/taglib.git
        branch: master 
  - name: OpenKJ
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/openkj/openkj.git
        branch: stable 
finish-args: 
  - "--share=ipc"
  - "--socket=x11"
  - "--device=dri"
  - "--share=network"
    #  - "--socket=wayland"
  - "--socket=pulseaudio"
  - "--filesystem=host"
  - "--env=LADSPA_PATH=/app/lib/ladspa/"
  - "--env=QT_QPA_PLATFORM=xcb"
  - "--env=GST_PLUGIN_PATH=/app/lib/codecs/lib/gstreamer-1.0"
  - "--env=PATH=/app/lib/totem-pl-parser/bin/:/app/lib/codecs/bin/:/app/bin:/usr/bin"
cleanup-commands:
  - "mv /app/lib/liba52*.* /app/lib/codecs/lib/"
  - "mv /app/lib/libass.* /app/lib/codecs/lib/"
  - "mkdir -p /app/lib/ffmpeg"
